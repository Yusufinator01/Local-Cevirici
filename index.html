<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Yerel Dönüştürücü — Görsel / Ses / Video</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: #0f172a;
        --muted: #94a3b8;
        --text: #e6eef8;
        --accent: #7dd3fc;
        --accent-2: #38bdf8;
        --danger: #ef4444;
        --ok: #22c55e;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: radial-gradient(
            1200px 600px at 10% -10%,
            rgba(56, 189, 248, 0.07),
            transparent
          ),
          radial-gradient(
            1000px 480px at 110% 10%,
            rgba(125, 211, 252, 0.06),
            transparent
          ),
          var(--bg);
        color: var(--text);
        font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .shell {
        width: 100%;
        max-width: 980px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.015)
        );
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(2, 6, 23, 0.45);
      }
      .header {
        padding: 18px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .title {
        font-size: 18px;
        margin: 0;
      }
      .body {
        padding: 16px;
      }
      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr 1fr;
      }
      @media (max-width: 820px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
      label {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
        display: block;
      }
      select,
      input[type="file"] {
        width: 100%;
        background: #0b1530;
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 12px;
        border-radius: 10px;
        color: var(--text);
        outline: none;
      }
      select:focus,
      input[type="file"]:focus {
        border-color: var(--accent);
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .chip {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        background: #0b1530;
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 10px 12px;
        border-radius: 10px;
      }
      .chip input {
        accent-color: var(--accent);
      }

      .actions {
        padding: 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        justify-content: flex-end;
      }
      .btn {
        appearance: none;
        border: 0;
        padding: 12px 16px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s transform, 0.2s box-shadow;
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
      .btn-primary {
        background: linear-gradient(180deg, var(--accent), var(--accent-2));
        color: #02131f;
        box-shadow: 0 12px 30px rgba(56, 189, 248, 0.25);
      }
      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 36px rgba(56, 189, 248, 0.35);
      }
      .btn-ghost {
        background: transparent;
        color: var(--muted);
        border: 1px dashed rgba(255, 255, 255, 0.1);
      }
      .btn-danger {
        background: linear-gradient(180deg, #fb7185, #ef4444);
        color: #220909;
      }
      .btn-disabled {
        opacity: 0.5;
        pointer-events: none;
      }

      .preview {
        margin-top: 14px;
        border-radius: 12px;
        background: #0b1530;
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 12px;
        min-height: 120px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: flex-start;
        color: var(--muted);
      }
      .preview img,
      .preview video {
        max-width: 120px;
        border-radius: 10px;
      }
      .preview audio {
        width: 120px;
      }

      .toast {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }
      .toast.show {
        display: flex;
      }
      .toast-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(2, 6, 23, 0.6);
        backdrop-filter: blur(4px);
      }
      .toast-card {
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 460px;
        border-radius: 16px;
        background: linear-gradient(
          180deg,
          rgba(34, 197, 94, 0.08),
          rgba(34, 197, 94, 0.04)
        );
        border: 1px solid rgba(34, 197, 94, 0.25);
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.6);
        padding: 18px;
      }
      .toast-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .toast-title {
        font-weight: 700;
      }
      .toast-sub {
        color: var(--muted);
        font-size: 13px;
      }
      .toast-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
        justify-content: flex-end;
      }

      .notice {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }

      /* FOOTER STİLİ */
      footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        color: white;
        text-align: center;
        padding: 10px 0;
        font-size: 14px;
        box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.2);
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="card">
        <div class="header">
          <h1 class="title">Yerel Dönüştürücü</h1>
          <span class="notice"
            >Dosyalarınız cihazınızda kalır • Karanlık tema</span
          >
        </div>
        <div class="body">
          <div class="grid">
            <div>
              <label for="category">Kategori</label>
              <select id="category" aria-label="Kategori seç">
                <option value="image">Görsel</option>
                <option value="audio">Ses</option>
                <option value="video">Video</option>
                <option value="doc">Belge</option>
                <option value="archive">Arşiv</option>
              </select>
            </div>
            <div>
              <label for="file">Dosya Seç</label>
              <input id="file" type="file" aria-label="Dosya yükle" multiple />
            </div>
            <div>
              <label for="format">Hedef Format</label>
              <select id="format" aria-label="Hedef format seç"></select>
            </div>
            <div>
              <label>Seçenekler</label>
              <div class="row" role="group" aria-label="Dönüşüm seçenekleri">
                <span class="chip"
                  ><input id="keepMeta" type="checkbox" />
                  <span>Meta koru</span></span
                >
                <span class="chip"
                  ><input id="smallSize" type="checkbox" />
                  <span>Küçük boyut</span></span
                >
              </div>
            </div>
          </div>

          <div class="preview" id="preview">
            Önizleme: Henüz dosya seçilmedi
          </div>
        </div>
        <div class="actions">
          <button id="convert" class="btn btn-primary" aria-label="Dönüştür">
            ⚡ Dönüştür
          </button>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">
      <div class="toast-backdrop"></div>
      <div class="toast-card">
        <div class="toast-head">
          <div>
            <div class="toast-title">✅ Dönüşüm tamamlandı</div>
            <div class="toast-sub" id="toastSub">—</div>
          </div>
          <button class="btn btn-ghost" id="closeToast" aria-label="Kapat">
            ✕
          </button>
        </div>
        <div class="toast-actions">
          <button class="btn btn-danger" id="cancelBtn">İptal</button>
          <button class="btn btn-primary" id="downloadBtn">İndir</button>
        </div>
      </div>
    </div>

    <!-- FOOTER BURADA -->
    <footer>Bu Site Yusuf Tarafından Yapılmıştır</footer>

    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.8/dist/ffmpeg.min.js"></script>
    <script>
      const categoryEl = document.getElementById("category");
      const fileEl = document.getElementById("file");
      const formatEl = document.getElementById("format");
      const keepMetaEl = document.getElementById("keepMeta");
      const smallSizeEl = document.getElementById("smallSize");
      const previewEl = document.getElementById("preview");
      const convertBtn = document.getElementById("convert");
      const toast = document.getElementById("toast");
      const toastSub = document.getElementById("toastSub");
      const closeToast = document.getElementById("closeToast");
      const cancelBtn = document.getElementById("cancelBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      let currentFiles = [];
      let convertedBlobs = [];
      let resultExt = "";
      let ffmpeg = null;

      const FORMATS = {
        image: ["jpg", "jpeg", "png", "webp", "gif", "bmp", "tiff", "avif"],
        audio: ["mp3", "wav", "ogg", "flac", "aac", "m4a", "opus"],
        video: ["mp4", "webm", "mkv", "mov", "avi", "gif"],
        doc: ["pdf", "txt", "md"],
        archive: ["zip", "tar", "gz"],
      };

      function fillFormats() {
        const cat = categoryEl.value;
        formatEl.innerHTML = "";
        (FORMATS[cat] || []).forEach((ext) => {
          const o = document.createElement("option");
          o.value = ext;
          o.textContent = ext.toUpperCase();
          formatEl.appendChild(o);
        });
      }
      fillFormats();
      categoryEl.addEventListener("change", () => {
        fillFormats();
      });

      // Önizleme çoklu
      fileEl.addEventListener("change", () => {
        currentFiles = Array.from(fileEl.files) || [];
        showPreview();
      });

      function showPreview() {
        previewEl.innerHTML = "";
        if (currentFiles.length === 0) {
          previewEl.textContent = "Önizleme: Henüz dosya seçilmedi";
          return;
        }
        currentFiles.forEach((file) => {
          const t = file.type || "";
          const container = document.createElement("div");
          container.style.display = "flex";
          container.style.flexDirection = "column";
          container.style.alignItems = "center";
          if (t.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.style.maxWidth = "120px";
            container.appendChild(img);
          } else if (t.startsWith("audio/")) {
            const a = document.createElement("audio");
            a.controls = true;
            a.src = URL.createObjectURL(file);
            container.appendChild(a);
          } else if (t.startsWith("video/")) {
            const v = document.createElement("video");
            v.controls = true;
            v.src = URL.createObjectURL(file);
            v.style.maxWidth = "120px";
            container.appendChild(v);
          } else {
            container.textContent = file.name;
          }
          previewEl.appendChild(container);
        });
      }

      // Yardımcılar
      function baseName(filename) {
        const i = filename.lastIndexOf(".");
        return i > 0 ? filename.slice(0, i) : filename;
      }
      function extName(filename) {
        const i = filename.lastIndexOf(".");
        return i > 0 ? filename.slice(i + 1) : "";
      }

      async function convertImage(file, outExt) {
        const mime =
          outExt === "jpg" || outExt === "jpeg"
            ? "image/jpeg"
            : outExt === "png"
            ? "image/png"
            : outExt === "webp"
            ? "image/webp"
            : outExt === "gif"
            ? "image/gif"
            : outExt === "avif"
            ? "image/avif"
            : "image/png";
        const img = new Image();
        img.src = URL.createObjectURL(file);
        await img.decode();
        const canvas = document.createElement("canvas");
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);
        const quality = smallSizeEl.checked ? 0.7 : 0.95;
        return new Promise((res, rej) => {
          canvas.toBlob(
            (b) => (b ? res(b) : rej(new Error("Dönüşüm başarısız"))),
            mime,
            quality
          );
        });
      }

      async function ensureFFmpeg() {
        if (ffmpeg) return ffmpeg;
        const { createFFmpeg, fetchFile } = FFmpeg;
        ffmpeg = createFFmpeg({ log: false });
        await ffmpeg.load();
        ffmpeg._fetchFile = fetchFile;
        return ffmpeg;
      }

      async function convertWithFFmpeg(file, outExt, isAudio) {
        await ensureFFmpeg();
        const inName = "in." + (extName(file.name) || "bin");
        const outName = "out." + outExt;
        ffmpeg.FS("writeFile", inName, await ffmpeg._fetchFile(file));
        const args = ["-i", inName];
        if (isAudio) {
          args.push("-b:a", smallSizeEl.checked ? "128k" : "320k");
          if (keepMetaEl.checked) args.push("-map_metadata", "1");
        } else {
          if (outExt === "mp4" || outExt === "mov" || outExt === "mkv") {
            args.push(
              "-c:v",
              "libx264",
              "-b:v",
              smallSizeEl.checked ? "1500k" : "4500k",
              "-preset",
              "veryfast",
              "-c:a",
              "aac"
            );
          } else if (outExt === "webm") {
            args.push(
              "-c:v",
              "libvpx-vp9",
              "-b:v",
              smallSizeEl.checked ? "1200k" : "3200k",
              "-c:a",
              "libopus"
            );
          } else if (outExt === "gif") {
            args.push("-vf", "fps=15,scale=iw:-1:flags=lanczos");
          }
          if (keepMetaEl.checked) args.push("-map_metadata", "1");
        }
        args.push(outName);
        try {
          await ffmpeg.run(...args);
        } finally {
        }
        const out = ffmpeg.FS("readFile", outName);
        try {
          ffmpeg.FS("unlink", inName);
          ffmpeg.FS("unlink", outName);
        } catch (_) {}
        return new Blob([out.buffer]);
      }

      // Dönüştürme (sadece dönüştür, indirme değil)
      convertBtn.addEventListener("click", async () => {
        if (currentFiles.length === 0) {
          alert("Lütfen dosya seçin");
          return;
        }
        convertBtn.classList.add("btn-disabled");
        convertedBlobs = [];
        try {
          for (const file of currentFiles) {
            const outExt = formatEl.value;
            resultExt = outExt;
            let blob = null;
            if ((file.type || "").startsWith("image/")) {
              blob = await convertImage(file, outExt);
            } else if ((file.type || "").startsWith("audio/")) {
              blob = await convertWithFFmpeg(file, outExt, true);
            } else if ((file.type || "").startsWith("video/")) {
              blob = await convertWithFFmpeg(file, outExt, false);
            } else if (categoryEl.value === "doc") {
              const txt = await file.text();
              blob = new Blob([txt], { type: "text/plain" });
            } else {
              alert(file.name + " — Bu dosya türü desteklenmiyor");
              continue;
            }
            convertedBlobs.push({ name: baseName(file.name), blob: blob });
          }
          if (convertedBlobs.length > 0) {
            toastSub.textContent = `${convertedBlobs.length} dosya dönüştürüldü`;
            toast.classList.add("show");
          }
        } catch (err) {
          console.error(err);
          alert("Hata: " + (err.message || err));
        } finally {
          convertBtn.classList.remove("btn-disabled");
        }
      });

      // Toplu indirme
      downloadBtn.addEventListener("click", () => {
        if (convertedBlobs.length === 0) return;
        convertedBlobs.forEach((item) => {
          const a = document.createElement("a");
          a.href = URL.createObjectURL(item.blob);
          a.download = item.name + "." + resultExt;
          document.body.appendChild(a);
          a.click();
          a.remove();
        });
        toast.classList.remove("show");
      });

      closeToast.addEventListener("click", () => {
        toast.classList.remove("show");
      });
      cancelBtn.addEventListener("click", () => {
        toast.classList.remove("show");
      });
    </script>
  </body>
</html>
